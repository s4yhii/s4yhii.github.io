<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Tickets and Popcorn please!, The Day main.js Became the Key Vault" /><meta property="og:locale" content="en" /><meta name="description" content="Disclaimer This blog post is shared for educational and academic purposes only. All issues described here were responsibly reported to the affected company and have since been fixed and verified. Permission to publish was granted by the company. The intention of this write-up is to raise awareness, improve security practices, and share lessons learned with the community." /><meta property="og:description" content="Disclaimer This blog post is shared for educational and academic purposes only. All issues described here were responsibly reported to the affected company and have since been fixed and verified. Permission to publish was granted by the company. The intention of this write-up is to raise awareness, improve security practices, and share lessons learned with the community." /><link rel="canonical" href="https://s4yhii.github.io/posts/Tickets-popcorn-please/" /><meta property="og:url" content="https://s4yhii.github.io/posts/Tickets-popcorn-please/" /><meta property="og:site_name" content="s4yhii’s Blog" /><meta property="og:image" content="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/cover.png" /><meta property="og:image:height" content="850" /><meta property="og:image:width" content="600" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-08-25T08:00:00-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/cover.png" /><meta property="twitter:title" content="Tickets and Popcorn please!, The Day main.js Became the Key Vault" /><meta name="twitter:site" content="@s4yhii" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-08-25T14:55:58-05:00","datePublished":"2025-08-25T08:00:00-05:00","description":"Disclaimer This blog post is shared for educational and academic purposes only. All issues described here were responsibly reported to the affected company and have since been fixed and verified. Permission to publish was granted by the company. The intention of this write-up is to raise awareness, improve security practices, and share lessons learned with the community.","headline":"Tickets and Popcorn please!, The Day main.js Became the Key Vault","image":{"height":850,"width":600,"url":"https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/cover.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://s4yhii.github.io/posts/Tickets-popcorn-please/"},"url":"https://s4yhii.github.io/posts/Tickets-popcorn-please/"}</script><title>Tickets and Popcorn please!, The Day main.js Became the Key Vault | s4yhii's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="s4yhii's Blog"><meta name="application-name" content="s4yhii's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/streams/dance-pikachu.gif" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">s4yhii's Blog</a></div><div class="site-subtitle font-italic">Appsec blog, CTF write-ups and more</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/s4yhii" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/s4yhii" aria-label="twitter" target="_blank" rel="noopener"> <i class="fa-brands fa-x-twitter"></i> </a> <a href="https://www.linkedin.com/in/jesusluj4n" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://app.hackthebox.com/profile/274780" aria-label="HackTheBox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Tickets and Popcorn please!, The Day main.js Became the Key Vault</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Tickets and Popcorn please!, The Day main.js Became the Key Vault</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1756126800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 25, 2025 </em> </span> <span> Updated <em class="" data-ts="1756151758" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 25, 2025 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 850'%3E%3C/svg%3E" data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/cover.png" class="preview-img bg" alt="Preview Image" width="600" height="850" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/s4yhii">Jesus Lujan</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1451 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h2 id="disclaimer"><span class="mr-2">Disclaimer</span><a href="#disclaimer" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This blog post is shared for educational and academic purposes only. All issues described here were responsibly reported to the affected company and have since been fixed and verified. Permission to publish was granted by the company. The intention of this write-up is to raise awareness, improve security practices, and share lessons learned with the community.</p><h1 id="act-i--the-setup">Act I — The Setup</h1><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/four.gif" alt="alt text" data-proofer-ignore></p><p>It all started on a lazy evening in April. I wasn’t trying to hack anything major, just poking around a movie ticketing site which I’m client of with DevTools open. As I added a ticket to my cart, something odd caught my eye: a POST request carrying a mysterious parameter named encInfo.</p><p><code class="language-plaintext highlighter-rouge">“Why would a frontend encrypt its own traffic before sending it to its backend?”</code></p><p>Pro Tip: In Caido, the first thing I do is filter the HTTP History with HTTPQL to cut out analytics noise and static requests. For example:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nx">cont</span><span class="p">:</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span> <span class="nx">and</span> <span class="nx">not</span> <span class="nx">req</span><span class="p">.</span><span class="nx">host</span><span class="p">.</span><span class="nx">cont</span><span class="p">:</span><span class="dl">"</span><span class="s2">analytics</span><span class="dl">"</span>
</pre></table></code></div></div><p>That was the spark. What began as casual curiosity turned into a journey where I ended up pulling strangers’ receipts and breaking AES encryption in the browser.</p><p><code class="language-plaintext highlighter-rouge">“The checkout flow looked ordinary, until I noticed encInfo.”</code></p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/1.png" alt="alt text" data-proofer-ignore></p><h1 id="act-ii--the-first-discovery-ghost-receipts">Act II — The First Discovery: Ghost Receipts</h1><p>That weekend, I had planned to go to the movies with my girlfriend. She sent me a screenshot of her reservation: it showed the bookingId and the QR code of the ticket, but not the seat numbers. Curious, I wondered if it was possible to retrieve the full ticket details including seats using only the order number.</p><p>With that in mind, I opened the developer tools and as I downloaded one of my own tickets, I began watching the network traffic, and that’s when I noticed a request that looked especially interesting.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/4.png" alt="alt text" data-proofer-ignore></p><p>At first glance it felt too simple. My instinct was: surely the backend must cross-check this against a logged-in session or some signature. To confirm, I stripped the cookies and replayed the request. It still worked. That’s when I realized this endpoint was completely unauthenticated.</p><p>Pro Tip: In Caido I like to replay with headers removed one by one (auth tokens, cookies, referers). This quickly reveals which ones actually matter. In this case, none did.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/2.png" alt="alt text" data-proofer-ignore></p><p>Next, I wondered how resilient it was against tampering. I changed the bookingId slightly, swapping the last character. Half-expecting a 403 or error, I instead got back a massive Base64 blob in the response.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/3.png" alt="alt text" data-proofer-ignore></p><p>A full movie ticket receipt for a user I had no relationship with that includes the following info: Full Name, Movie Title, Cine, Seat reserver, Date of visit, total price paid.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/one.gif" alt="alt text" data-proofer-ignore></p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/6.png" alt="alt text" data-proofer-ignore></p><p>The invoice retrieval relied entirely on a <code class="language-plaintext highlighter-rouge">bookingId</code> string — a 7-character alphanumeric identifier starting with <code class="language-plaintext highlighter-rouge">W</code>. I tried to reverse engineer this string, but was not created in the front, instead in the back, so it was random. Through light fuzzing and guesswork, I retrieved several valid receipts. But I needed scale, with a few lines of Python, I wrote a brute-forcer — and within seconds, my terminal was spitting out dozens of receipts.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/5.png" alt="alt text" data-proofer-ignore></p><p>Some of the booking IDs I brute-forced returned perfectly valid, usable tickets, while others came back as expired or invalid. If the showtime was scheduled for the same day, the receipt was essentially “live” and could be used to claim entry. Anything older would still return a receipt, but one that no longer held any real-world value.</p><p>This meant an attacker could take a valid booking ID, use it against the system, and walk into the cinema using someone else’s ticket. Because the IDs were weak and there was no authentication, what first looked like a small privacy issue quickly became a serious access control flaw, with real financial and reputational impact.</p><h1 id="act-iii--the-cipher-in-the-browser">Act III — The Cipher in the Browser</h1><p>Even after pulling receipts, something still bugged me. Every sensitive request — adding tickets, concessions, even returns — had that weird encInfo blob attached. It was like a secret note passed between the frontend and the backend, except the note was just a mess of hex characters.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/8.png" alt="alt text" data-proofer-ignore></p><p>At first, I tried poking at it. Change a byte, send it back, watch what happens. Every time I did, the server threw me either a 400 Bad Request or a 500 Internal Server Error. That told me one thing: this blob wasn’t just noise. The backend really cared about it.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/two.gif" alt="alt text" data-proofer-ignore></p><p>So I switched gears. If the backend cared so much, maybe the frontend could tell me why. I opened Chrome DevTools, jumped into Sources, and started scrolling through the minified spaghetti that was main.js.</p><p>When hunting for crypto in JS, I’ve learned a trick: search for obvious strings like “AES” or “encrypt”, or just regex for anything that looks like a key. Thirty-two characters, all numbers? Suspicious. Sixteen characters of lowercase letters? Even more suspicious.</p><p>And there it was. Jackpot. Right in the middle of the bundle:</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/7.png" alt="alt text" data-proofer-ignore></p><p>After scrolling through the minified main.js, I finally spotted the smoking gun: both the encryption key and the initialization vector (IV) were hard-coded directly into the bundle. That meant every encinfo request from the frontend was being encrypted with the exact same values, fully exposed to anyone inspecting the source. Right next to them, I also found the function call responsible for wrapping the sensitive JSON data before sending it to the backend:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">AES</span><span class="p">.</span><span class="nf">encrypt</span><span class="p">(</span><span class="nf">pad</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="mi">16</span><span class="p">),</span> <span class="nx">KEY</span><span class="p">,</span> <span class="p">{</span> <span class="na">iv</span><span class="p">:</span> <span class="nx">IV</span> <span class="p">});</span>
</pre></table></code></div></div><p>No obfuscation. No key rotation. Just the crypto equivalent of leaving your house key under the doormat.</p><p>Lesson: <strong>Never trust the client to encrypt or validate anything important.</strong></p><p>At this point, the puzzle pieces clicked together. If I had the key and the IV, then that big scary encInfo blob wasn’t scary at all, it was just encrypted JSON waiting to be freed.</p><p>So I copied one out of a real request, fired up a quick Python script with PyCryptodome, and hit run:</p><div class="language-javascript highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">from</span> <span class="nx">Crypto</span><span class="p">.</span><span class="nx">Cipher</span> <span class="k">import</span> <span class="nx">AES</span>
<span class="k">from</span> <span class="nx">Crypto</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">Padding</span> <span class="k">import</span> <span class="nx">unpad</span>
<span class="k">import</span> <span class="nx">binascii</span>

<span class="nx">KEY</span> <span class="o">=</span> <span class="nx">b</span><span class="dl">"</span><span class="s2">22021509147968334581420394558985</span><span class="dl">"</span>
<span class="nx">IV</span>  <span class="o">=</span> <span class="nx">b</span><span class="dl">"</span><span class="s2">ibfxivitgrpewzgj</span><span class="dl">"</span>

<span class="nx">data</span> <span class="o">=</span> <span class="nx">binascii</span><span class="p">.</span><span class="nf">unhexlify</span><span class="p">(</span><span class="dl">"</span><span class="s2">37B0E9B8...</span><span class="dl">"</span><span class="p">)</span>  <span class="err">#</span> <span class="nx">sample</span> <span class="nx">encInfo</span>
<span class="nx">cipher</span> <span class="o">=</span> <span class="nx">AES</span><span class="p">.</span><span class="k">new</span><span class="p">(</span><span class="nx">KEY</span><span class="p">,</span> <span class="nx">AES</span><span class="p">.</span><span class="nx">MODE_CBC</span><span class="p">,</span> <span class="nx">IV</span><span class="p">)</span>
<span class="nx">plaintext</span> <span class="o">=</span> <span class="nf">unpad</span><span class="p">(</span><span class="nx">cipher</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nx">plaintext</span><span class="p">.</span><span class="nf">decode</span><span class="p">())</span>
</pre></table></code></div></div><p>And out came a neat little JSON:</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"UserSessionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"995ec229c07cd2adc79289936e12f8fa"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"CinemaId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0000000001"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"Concessions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nl">"ItemId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2624"</span><span class="p">,</span><span class="w"> </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nl">"PriceInCents"</span><span class="p">:</span><span class="w"> </span><span class="mi">6300</span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"ReturnOrder"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"FirstRequest"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></table></code></div></div><p>With the key and IV in hand, encinfo was just AES‑CBC encrypted JSON. I grabbed one of my own requests, wrote a short Python script (PyCryptodome), and decrypted it. Out came plain business data: session IDs, items, prices, flags. For example, my popcorn order showed 6300 cents.</p><div class="language-json highlighter-rouge"><div class="code-header"> <span data-label-text="JSON"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nl">"Concessions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="nl">"ItemId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2624"</span><span class="p">,</span><span class="w"> </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nl">"PriceInCents"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></pre></table></code></div></div><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/9.png" alt="alt text" data-proofer-ignore></p><p>I then re‑encrypted the edited JSON with the same key/IV, dropped it back into the request, and replayed it.</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/10.png" alt="alt text" data-proofer-ignore></p><p>The backend didn’t blink. No error, no integrity check, no “are you kidding me?”</p><p><img data-src="https://raw.githubusercontent.com/s4yhii/s4yhii.github.io/master/assets/images/Writeup/cinema/three.gif" alt="alt text" data-proofer-ignore></p><p>This means an attacker could (not tested):</p><ul><li>Forge tickets and concession orders.<li>Abuse the order flow (<code class="language-plaintext highlighter-rouge">ReturnOrder</code>, <code class="language-plaintext highlighter-rouge">ProcessOrderValue</code>).<li>Change prices or claim refunds.</ul><p>That’s when it hit me: the browser wasn’t just handling presentation; it was acting like the bank vault for the entire ordering process. And with the AES key and IV lying around in main.js, I hadn’t broken in — they’d handed me the vault combination.</p><h1 id="summary">Summary</h1><p>The platform exposed two critical flaws:</p><ol><li><p><strong>Unauthenticated invoice API.</strong> Given only a bookingId, it returned Base64‑encoded PDF receipts, enabling enumeration and ticket misuse.</p><li><p><strong>Client‑side AES with hard‑coded secrets.</strong> The frontend used AES‑CBC with a static key and IV in main.js, allowing decryption, modification, and re‑encryption of sensitive request payloads (sessions, tickets, concessions, refunds) with no integrity protection.</p></ol><p>Together, these issues could leak personal information, enumerate active tickets, forge or alter orders, and abuse refund flows. Once I confirmed the impact, I stopped testing and reported it responsibly</p><h2 id="lessons-learned"><span class="mr-2">Lessons Learned</span><a href="#lessons-learned" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><p><strong>Never trust the client for security.</strong> Cryptographic operations and secrets should live on the server, not in JavaScript.</p><li><p><strong>Use integrity checks.</strong> Encrypted blobs must be signed (e.g., HMAC, AEAD) to prevent tampering.</p><li><p><strong>Protect sensitive APIs with authentication and authorization.</strong> A booking receipt is personal data, it should never be accessible unauthenticated.</p><li><p><strong>Avoid predictable identifiers.</strong> Short, sequential booking codes make brute-forcing feasible; use long, random identifiers.</p><li><p><strong>Avoid security through obscurity</strong></p></ul><h2 id="timeline"><span class="mr-2">Timeline</span><a href="#timeline" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="table-wrapper"><table><thead><tr><th>Date<th>Action<tbody><tr><td>April, 30, 2025<td>Initial report sent to the company<tr><td>May, 07, 2025<td>Initial response from the company<tr><td>June, 30, 2025<td>Vulnerability fixed, unable to reproduce<tr><td>August 21, 2025<td>Company give the rights to publish<tr><td>August 30, 2025<td>Blog post released</table></div><h2 id="thanks"><span class="mr-2">Thanks</span><a href="#thanks" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I hope this write‑up is useful. Thanks for reading and sharing.</p><p>We’ll be back soon. Special thanks for their help reviewing this post to:</p><ul><li>PuneyK<li>Alguien<li>xpnt<li>MrDesdes</ul><p>Until the next one, stay curious, stay ethical.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeup/'>Writeup</a>, <a href='/categories/bug-bounty/'>Bug Bounty</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeup/" class="post-tag no-text-decoration" >Writeup</a> <a href="/tags/bug-bounty/" class="post-tag no-text-decoration" >Bug Bounty</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Tickets+and+Popcorn+please%21%2C+The+Day+main.js+Became+the+Key+Vault+-+s4yhii%27s+Blog&url=https%3A%2F%2Fs4yhii.github.io%2Fposts%2FTickets-popcorn-please%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Tickets+and+Popcorn+please%21%2C+The+Day+main.js+Became+the+Key+Vault+-+s4yhii%27s+Blog&u=https%3A%2F%2Fs4yhii.github.io%2Fposts%2FTickets-popcorn-please%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fs4yhii.github.io%2Fposts%2FTickets-popcorn-please%2F&text=Tickets+and+Popcorn+please%21%2C+The+Day+main.js+Became+the+Key+Vault+-+s4yhii%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Tickets-popcorn-please/">Tickets and Popcorn please!, The Day main.js Became the Key Vault</a><li><a href="/posts/CyberApocalypse-CTF2025-Web/">Cyber Apocalypse 2025 - 6x Web Challenges Writeup</a><li><a href="/posts/CyberApocalypse-CTF2024-Web/">Cyber Apocalypse 2024 - 4x Web Challenges Writeup</a><li><a href="/posts/Web-Cache-Poisoning/">Web Cache Poisoning Techniques</a><li><a href="/posts/HTB-Cyber-Apocalypse-CTF-Web-Writeups/">Cyber Apocalypse 2023 2x Web Challenges Writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web-security/">web security</a> <a class="post-tag" href="/tags/owasp/">owasp</a> <a class="post-tag" href="/tags/labs/">labs</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cms/">cms</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/CyberApocalypse-CTF2025-Web/"><div class="card-body"> <em class="small" data-ts="1742907600" data-df="ll" > Mar 25, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cyber Apocalypse 2025 - 6x Web Challenges Writeup</h3><div class="text-muted small"><p> I participated as a member of team CibersecUNI. This time i managed to solve all 6/6 challenges in the web category. Whispers of the Moonbeam Observando las funciones, nos dan una pista que se pu...</p></div></div></a></div><div class="card"> <a href="/posts/CyberApocalypse-CTF2024-Web/"><div class="card-body"> <em class="small" data-ts="1710421200" data-df="ll" > Mar 14, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Cyber Apocalypse 2024 - 4x Web Challenges Writeup</h3><div class="text-muted small"><p> I participated as a member of team CibersecUNI. In the web category we solved 6/9 challenges as a team. In this writeup I will go through the ones that I have solved: Testimonial Labyrinth Li...</p></div></div></a></div><div class="card"> <a href="/posts/Web-Cache-Poisoning/"><div class="card-body"> <em class="small" data-ts="1707580800" data-df="ll" > Feb 10, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Web Cache Poisoning Techniques</h3><div class="text-muted small"><p> Web cache Poisoning Web cache poisoning is not web cache deception, is not response splitting or request smuggling web cache deception tricking caches into storing sensitive information so the atta...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CyberApocalypse-CTF2025-Web/" class="btn btn-outline-primary" prompt="Older"><p>Cyber Apocalypse 2025 - 6x Web Challenges Writeup</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "s4yhii/s4yhii.github.io", "data-repo-id": "R_kgDOHtsc-g", "data-category": "Announcements", "data-category-id": "DIC_kwDOHtsc-s4CQh10", "data-mapping": "title", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "top", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/s4yhii">Jesus Lujan</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/web-security/">web security</a> <a class="post-tag" href="/tags/owasp/">owasp</a> <a class="post-tag" href="/tags/labs/">labs</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/web/">web</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/cms/">cms</a> <a class="post-tag" href="/tags/python/">python</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-V0V53P7YVQ"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-V0V53P7YVQ'); }); </script>
